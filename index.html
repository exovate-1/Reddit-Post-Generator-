<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Reddit Post Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-ibm {
            font-family: 'IBM Plex Sans', sans-serif;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .post-body a { color: #2563eb; }
        input[type="file"] { display: none; }
        .custom-file-upload {
            border: 1px solid #d1d5db; display: inline-block; padding: 8px 12px;
            cursor: pointer; background-color: #f9fafb; border-radius: 0.75rem; /* more rounded */
            transition: background-color 0.2s;
            font-weight: 500;
        }
        .custom-file-upload:hover { background-color: #f3f4f6; }
        .spoiler > * { filter: blur(5px); transition: filter 0.2s; }
        .spoiler:hover > * { filter: blur(0); }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col lg:flex-row min-h-screen">

    <!-- CONTROLS PANEL -->
    <div id="controls-panel" class="w-full lg:w-2/5 xl:w-1/3 p-6 bg-white shadow-2xl overflow-y-auto">
        <h1 class="text-3xl font-bold mb-8 text-center text-slate-900">Post Editor</h1>
        
        <div class="space-y-8">
            <!-- Section: General -->
            <div>
                <h2 class="text-xl font-semibold mb-4 text-slate-800 border-b border-slate-200 pb-2">General Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label for="template" class="block text-sm font-medium text-slate-600 mb-1">Layout Template</label>
                        <select id="template" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="card">Modern Card View</option>
                            <option value="classic">Classic Compact View</option>
                            <option value="wide">Wide View</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Section: Post Info -->
            <div>
                <h2 class="text-xl font-semibold mb-4 text-slate-800 border-b border-slate-200 pb-2">Post & User Info</h2>
                <div class="space-y-4">
                    <div>
                        <label for="subreddit" class="block text-sm font-medium text-slate-600 mb-1">Subreddit (r/)</label>
                        <input type="text" id="subreddit" value="sidehustle" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="username" class="block text-sm font-medium text-slate-600 mb-1">Username (u/)</label>
                        <input type="text" id="username" value="CreativeUser123" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="time" class="block text-sm font-medium text-slate-600 mb-1">Time Posted</label>
                        <input type="text" id="time" value="4 hours ago" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="edited-time" class="block text-sm font-medium text-slate-600 mb-1">Edited Timestamp (optional)</label>
                        <input type="text" id="edited-time" placeholder="e.g., 2 hours ago" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>
            
            <!-- Section: Icon -->
            <div>
                <h2 class="text-xl font-semibold mb-4 text-slate-800 border-b border-slate-200 pb-2">Icon / Profile Picture</h2>
                <div class="space-y-3">
                    <div>
                        <label for="icon-url" class="block text-sm font-medium text-slate-600 mb-1">Icon from URL</label>
                        <input type="text" id="icon-url" placeholder="Paste image URL here" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                         <label for="icon-upload" class="custom-file-upload text-sm font-medium text-slate-600">Upload Your Own</label>
                         <input type="file" id="icon-upload" accept="image/*">
                    </div>
                     <div>
                        <label class="block text-sm font-medium text-slate-600 mb-2">Or pick a default</label>
                        <div id="default-avatars" class="flex flex-wrap gap-2"></div>
                     </div>
                </div>
            </div>

            <!-- Section: Content -->
            <div>
                <h2 class="text-xl font-semibold mb-4 text-slate-800 border-b border-slate-200 pb-2">Content & Flair</h2>
                <div class="space-y-4">
                    <div>
                        <label for="title" class="block text-sm font-medium text-slate-600 mb-1">Post Title</label>
                        <input type="text" id="title" value="Just launched my new project, The Launchpad! Here's what I learned." class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex-grow">
                            <label for="flair" class="block text-sm font-medium text-slate-600 mb-1">Flair Text</label>
                            <input type="text" id="flair" value="Discussion" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="flair-color" class="block text-sm font-medium text-slate-600 mb-1">Color</label>
                            <input type="color" id="flair-color" value="#2563eb" class="w-12 h-10 bg-slate-50 border border-slate-300 rounded-xl p-1 cursor-pointer">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Post Type</label>
                        <select id="post-type" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="text">Text Post</option>
                            <option value="image">Image Post</option>
                        </select>
                    </div>
                    <div id="text-content-controls">
                        <div class="flex justify-between items-center mb-1">
                             <label for="content" class="block text-sm font-medium text-slate-600">Post Content</label>
                        </div>
                        <textarea id="content" rows="6" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">Hey everyone, after months of hard work, I'm excited to share my new Discord server, <b>The Launchpad</b>. It's a community for entrepreneurs and creators to share ideas and grow together.</textarea>
                    </div>
                    <div id="image-content-controls" class="hidden">
                        <label for="image-url" class="block text-sm font-medium text-slate-600 mb-1">Image URL</label>
                        <input type="text" id="image-url" placeholder="Paste image URL for the post body" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Section: Status & Tags -->
            <div>
                <h2 class="text-xl font-semibold mb-4 text-slate-800 border-b border-slate-200 pb-2">Status & Tags</h2>
                <div class="p-4 bg-slate-50 rounded-2xl border border-slate-200 grid grid-cols-2 gap-4">
                    <label class="flex items-center space-x-3 cursor-pointer"><input type="checkbox" id="is-verified" class="form-checkbox h-5 w-5 text-blue-600 bg-slate-200 border-slate-300 rounded-md focus:ring-blue-500"><span>Verified Tick</span></label>
                    <label class="flex items-center space-x-3 cursor-pointer"><input type="checkbox" id="is-locked" class="form-checkbox h-5 w-5 text-yellow-500 bg-slate-200 border-slate-300 rounded-md focus:ring-yellow-500"><span>Locked Post</span></label>
                    <label class="flex items-center space-x-3 cursor-pointer"><input type="checkbox" id="is-pinned" class="form-checkbox h-5 w-5 text-green-500 bg-slate-200 border-slate-300 rounded-md focus:ring-green-500"><span>Pinned Post</span></label>
                    <label class="flex items-center space-x-3 cursor-pointer"><input type="checkbox" id="is-oc" class="form-checkbox h-5 w-5 text-indigo-500 bg-slate-200 border-slate-300 rounded-md focus:ring-indigo-500"><span>OC Tag</span></label>
                    <label class="flex items-center space-x-3 cursor-pointer"><input type="checkbox" id="is-spoiler" class="form-checkbox h-5 w-5 text-purple-500 bg-slate-200 border-slate-300 rounded-md focus:ring-purple-500"><span>Spoiler</span></label>
                    <label class="flex items-center space-x-3 cursor-pointer"><input type="checkbox" id="is-nsfw" class="form-checkbox h-5 w-5 text-red-500 bg-slate-200 border-slate-300 rounded-md focus:ring-red-500"><span>NSFW</span></label>
                </div>
            </div>
            
            <!-- Section: Stats -->
            <div>
                <h2 class="text-xl font-semibold mb-4 text-slate-800 border-b border-slate-200 pb-2">Stats</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="upvotes" class="block text-sm font-medium text-slate-600 mb-1">Upvotes</label>
                        <input type="number" id="upvotes" value="12300" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="comments" class="block text-sm font-medium text-slate-600 mb-1">Comments</label>
                        <input type="number" id="comments" value="456" class="w-full bg-slate-50 border border-slate-300 rounded-xl px-3 py-2 text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
            </div>

            <!-- Action Button -->
            <div class="pt-6">
                <button id="download-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl focus:outline-none focus:ring-4 focus:ring-blue-300">
                    Download Post as Image
                </button>
            </div>
        </div>
    </div>

    <!-- PREVIEW PANEL -->
    <div id="preview-panel" class="w-full lg:w-3/5 xl:w-2/3 p-4 sm:p-8 flex items-center justify-center bg-slate-100">
        <div id="preview-area" class="w-full">
            <!-- Template: Card -->
            <div id="template-card" class="max-w-2xl mx-auto">
                <div id="post-container-card" class="bg-white rounded-2xl shadow-lg flex">
                    <!-- Vote Counter -->
                    <div class="vote-counter flex flex-col items-center p-2 bg-slate-50 rounded-l-2xl">
                        <svg class="w-6 h-6 text-slate-400 hover:text-orange-500 cursor-pointer" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L1 12h5v10h12V12h5L12 2z"/></svg>
                        <span class="upvotes font-bold text-sm my-1 text-slate-800">12.3k</span>
                        <svg class="w-6 h-6 text-slate-400 hover:text-blue-600 cursor-pointer" viewBox="0 0 24 24" fill="currentColor"><path d="M12 22L23 12h-5V2H6v10H1l11 10z"/></svg>
                    </div>
                    <!-- Post Content -->
                    <div class="p-4 w-full">
                        <div class="post-meta flex items-center text-xs text-slate-500 mb-2 flex-wrap">
                            <img class="subreddit-icon w-5 h-5 rounded-full mr-2" src="https://placehold.co/20x20/2563eb/ffffff?text=S" alt="Subreddit Icon">
                            <span class="subreddit-name font-bold text-slate-800 mr-1">r/sidehustle</span>
                            <span class="mr-1">â€¢</span>
                            <span>Posted by u/<span class="username">CreativeUser123</span></span>
                            <svg class="verified-tick w-4 h-4 text-blue-500 ml-1 hidden" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a.75.75 0 00-1.06-1.06L9 10.94l-1.72-1.72a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.06 0l4.25-4.25z" clip-rule="evenodd"></path></svg>
                            <span class="time ml-1">4 hours ago</span>
                            <span class="edited-time ml-1 hidden italic">(edited 2 hours ago)</span>
                        </div>
                        <div class="flex items-center gap-2">
                             <svg class="pinned-icon w-4 h-4 text-green-500 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                            <h2 class="post-title text-xl font-medium text-slate-900">Just launched my new project, The Launchpad! Here's what I learned.</h2>
                             <svg class="locked-icon w-4 h-4 text-yellow-500 hidden" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="my-3 flex items-center gap-2 flex-wrap">
                            <span class="flair text-xs font-semibold px-2.5 py-0.5 rounded-full bg-blue-600 text-white">Discussion</span>
                            <span class="oc-tag hidden text-xs font-bold uppercase text-slate-500 border border-slate-400 rounded px-1.5 py-0.5">OC</span>
                            <span class="nsfw-tag hidden text-xs font-bold uppercase text-red-500 border border-red-500 rounded px-1.5 py-0.5">NSFW</span>
                        </div>
                        <div class="post-body-container">
                            <div class="post-content-text text-sm text-slate-800 leading-relaxed post-body"></div>
                            <div class="post-content-image hidden mt-2"><img src="" class="max-w-full rounded-xl max-h-[500px] mx-auto" alt="Post image"></div>
                        </div>
                        <div class="action-bar flex items-center mt-4 text-xs font-bold text-slate-500 space-x-4">
                            <div class="flex items-center hover:bg-slate-100 p-1 rounded-lg cursor-pointer">
                                <svg class="w-5 h-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd"></path></svg>
                                <span class="comments">456 Comments</span>
                            </div>
                            <div class="flex items-center hover:bg-slate-100 p-1 rounded-lg cursor-pointer">
                                <svg class="w-5 h-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"></path></svg>
                                <span>Share</span>
                            </div>
                            <div class="flex items-center hover:bg-slate-100 p-1 rounded-lg cursor-pointer">
                                <svg class="w-5 h-5 mr-1" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"></path></svg>
                                <span>Save</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Other templates will be cloned from this one -->
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- MAPPINGS & CORE LOGIC ---
    const mappings = {
        'subreddit': { selector: '.subreddit-name', type: 'text' },
        'username': { selector: '.username', type: 'text' },
        'time': { selector: '.time', type: 'text' },
        'edited-time': { selector: '.edited-time', type: 'edited' },
        'title': { selector: '.post-title', type: 'text' },
        'content': { selector: '.post-content-text', type: 'html' },
        'upvotes': { selector: '.upvotes', type: 'upvotes' },
        'comments': { selector: '.comments', type: 'comments' },
        'flair': { selector: '.flair', type: 'flair' },
        'image-url': { selector: '.post-content-image', type: 'image' },
        'icon-url': { selector: '.subreddit-icon', type: 'src' },
        'flair-color': { selector: '.flair', type: 'color' },
        'is-verified': { selector: '.verified-tick', type: 'toggle' },
        'is-locked': { selector: '.locked-icon', type: 'toggle' },
        'is-pinned': { selector: '.pinned-icon', type: 'toggle' },
        'is-oc': { selector: '.oc-tag', type: 'toggle' },
        'is-spoiler': { selector: '.post-body-container', type: 'class', className: 'spoiler' },
        'is-nsfw': { selector: '.nsfw-tag', type: 'toggle' },
    };

    function updateAllPreviews(id) {
        const mapping = mappings[id];
        if (!mapping) return;
        const { selector, type, className } = mapping;
        const inputEl = document.getElementById(id);
        const previewEls = document.querySelectorAll(selector);
        
        previewEls.forEach(previewEl => {
            if (!inputEl || !previewEl) return;
            let value = inputEl.type === 'checkbox' ? inputEl.checked : inputEl.value;

            switch(type) {
                case 'text': previewEl.textContent = value; break;
                case 'html': previewEl.innerHTML = value; break;
                case 'upvotes':
                    const votes = parseInt(value, 10) || 0;
                    previewEl.textContent = votes >= 1000 ? (votes / 1000).toFixed(1) + 'k' : votes;
                    break;
                case 'comments': previewEl.textContent = `${value} Comments`; break;
                case 'flair':
                    previewEl.textContent = value;
                    previewEl.style.display = value ? 'inline-flex' : 'none';
                    break;
                case 'image': previewEl.querySelector('img').src = value; break;
                case 'src': previewEl.src = value; break;
                case 'color': previewEl.style.backgroundColor = value; break;
                case 'toggle': previewEl.classList.toggle('hidden', !value); break;
                case 'class': previewEl.classList.toggle(className, value); break;
                case 'edited':
                    previewEl.textContent = value ? `(edited ${value})` : '';
                    previewEl.classList.toggle('hidden', !value);
                    break;
            }
        });
    }

    Object.keys(mappings).forEach(id => {
        const input = document.getElementById(id);
        if (input) {
            input.addEventListener('input', () => updateAllPreviews(id));
        }
    });

    // --- TEMPLATE LOGIC ---
    const templateSelect = document.getElementById('template');
    const previewArea = document.getElementById('preview-area');
    const cardTemplate = document.getElementById('template-card');

    if (!document.getElementById('template-classic')) {
        const classicTemplate = cardTemplate.cloneNode(true);
        classicTemplate.id = 'template-classic';
        classicTemplate.querySelector('#post-container-card').id = 'post-container-classic';
        classicTemplate.querySelector('.post-title').classList.remove('text-xl');
        classicTemplate.querySelector('.post-title').classList.add('text-base', 'font-medium');
        const classicVoteCounter = classicTemplate.querySelector('.vote-counter');
        classicVoteCounter.classList.add('flex-row', 'items-start', 'p-1', 'gap-1');
        classicVoteCounter.classList.remove('flex-col', 'p-2');
        classicVoteCounter.querySelector('.upvotes').classList.add('hidden');
        classicTemplate.querySelector('.post-body-container').classList.add('max-h-24', 'overflow-hidden');
        previewArea.appendChild(classicTemplate);
    }
    
    if (!document.getElementById('template-wide')) {
        const wideTemplate = cardTemplate.cloneNode(true);
        wideTemplate.id = 'template-wide';
        wideTemplate.querySelector('#post-container-card').id = 'post-container-wide';
        wideTemplate.classList.remove('max-w-2xl');
        wideTemplate.classList.add('w-full');
        previewArea.appendChild(wideTemplate);
    }
    
    const templates = {
        card: document.getElementById('template-card'),
        classic: document.getElementById('template-classic'),
        wide: document.getElementById('template-wide'),
    };

    templateSelect.addEventListener('change', () => {
        Object.values(templates).forEach(t => t.classList.add('hidden'));
        templates[templateSelect.value].classList.remove('hidden');
    });
    templateSelect.dispatchEvent(new Event('change'));

    // --- ICON LOGIC ---
    const iconUrlInput = document.getElementById('icon-url');
    const iconUploadInput = document.getElementById('icon-upload');

    function setAllIcons(src) {
        document.querySelectorAll('.subreddit-icon').forEach(icon => {
            icon.src = src || 'https://placehold.co/20x20/2563eb/ffffff?text=S';
        });
    }
    iconUrlInput.addEventListener('input', () => setAllIcons(iconUrlInput.value));
    iconUploadInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => setAllIcons(event.target.result);
            reader.readAsDataURL(file);
        }
    });
    const defaultAvatarsContainer = document.getElementById('default-avatars');
    const avatarColors = ['#FF4500', '#0079D3', '#FFD635', '#46D160', '#FF8717', '#24A0ED'];
    avatarColors.forEach(color => {
        const avatar = document.createElement('div');
        avatar.className = 'w-8 h-8 rounded-full cursor-pointer border-2 border-transparent hover:border-blue-500';
        avatar.style.backgroundColor = color;
        avatar.onclick = () => {
            const canvas = document.createElement('canvas');
            canvas.width = 64; canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = color; ctx.fillRect(0, 0, 64, 64);
            setAllIcons(canvas.toDataURL());
        };
        defaultAvatarsContainer.appendChild(avatar);
    });

    // --- POST TYPE ---
    const postTypeSelect = document.getElementById('post-type');
    postTypeSelect.addEventListener('change', () => {
        const isText = postTypeSelect.value === 'text';
        document.getElementById('text-content-controls').classList.toggle('hidden', !isText);
        document.getElementById('image-content-controls').classList.toggle('hidden', isText);
        document.querySelectorAll('.post-content-text').forEach(el => el.classList.toggle('hidden', !isText));
        document.querySelectorAll('.post-content-image').forEach(el => el.classList.toggle('hidden', isText));
    });

    // --- DOWNLOAD LOGIC ---
    document.getElementById('download-btn').addEventListener('click', () => {
        const visibleTemplate = document.querySelector('#preview-area > div:not(.hidden)');
        const postContainer = visibleTemplate.querySelector('div[id^="post-container-"]');
        
        html2canvas(postContainer, {
            useCORS: true,
            backgroundColor: '#f1f5f9',
            onclone: (doc) => {
                doc.querySelectorAll('.post-body a').forEach(a => a.style.textDecoration = 'none');
            }
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'reddit-post.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    });
    
    // Initial call to set everything up
    Object.keys(mappings).forEach(id => updateAllPreviews(id));
});
</script>
</body>
</html>
